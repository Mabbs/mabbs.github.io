---
layout: post
title: åˆ¶ä½œç¨‹åºè¿è¡Œæç¤ºæ ‡å¿—çš„å†ç¨‹
tags: [Python, ç¨‹åº, æ ‡å¿—]
---

  æœ‰å›¾å½¢ç•Œé¢çš„ç¨‹åºå¯çœŸæ˜¯éš¾åšå•Šâ€¦â€¦<!--more-->    

# èµ·å› 
  æœ€è¿‘æˆ‘åšäº†ä¸€ä¸ªç¨‹åºï¼Œç±»ä¼¼äºå®ˆæŠ¤è¿›ç¨‹é‚£æ ·çš„ä¸€ä¸ªç”¨Pythonåˆ¶ä½œçš„è„šæœ¬ã€‚è„šæœ¬åšå‡ºæ¥å¾ˆç®€å•ï¼Œå¯æ˜¯æˆ‘åšå‡ºæ¥ä¹‹åéœ€è¦å‘å…¶ä»–äººè¯æ˜æˆ‘åšçš„è„šæœ¬æ­£åœ¨è¿è¡Œï¼Œè€Œä¸”æ˜¯ç»™ä¸€ä¸ªä¸æ‡‚ç”µè„‘çš„äººçŸ¥é“ã€‚åœ¨è¿™ä¸ªå‰æä¸‹æˆ‘ä¸å¯èƒ½è®©å…¶ä»–äººå»çœ‹ä»»åŠ¡ç®¡ç†å™¨ã€æˆ–è€…æ‰§è¡Œ`ps -ef | grep xxx`è¿™ç§ä¸œè¥¿å§ã€‚æ‰€ä»¥è¿˜æ˜¯å¾—è®©å®ƒåœ¨è¿è¡Œçš„æ—¶å€™åœ¨æ¡Œé¢è¿™æ ·çš„å›¾å½¢ç•Œé¢æ˜¾ç¤ºä¸€äº›ä¸œè¥¿æ‰è¡Œã€‚   

# åˆ¶ä½œçš„å†ç¨‹
## ä½¿ç”¨æ‰˜ç›˜åŒºå›¾æ ‡
  åƒä¸€èˆ¬çš„åå°ç¨‹åºè¯æ˜è‡ªå·±å­˜åœ¨çš„æ–¹å¼å°±æ˜¯ä»»åŠ¡æ çš„æ‰˜ç›˜åŒºæ˜¾ç¤ºä¸€ä¸ªå›¾æ ‡ã€‚äºæ˜¯é¦–å…ˆæˆ‘å°±æŒ‰ç…§è¿™ä¸ªæƒ³æ³•å…ˆç”¨PyQt5ç„¶ååœ¨ç½‘ä¸Šæ‰¾äº†ä¸€æ®µä»£ç ç„¶åè‡ªå·±æ”¹äº†æ”¹ï¼š   
### ä½¿ç”¨PyQt5åº“å®ç°
```python
import sys
from PyQt5 import QtCore, QtGui, QtWidgets
from threading import Thread

class SystemTrayIcon(QtWidgets.QSystemTrayIcon):
    def __init__(self, icon, parent=None):
        QtWidgets.QSystemTrayIcon.__init__(self, icon, parent)

app = QtWidgets.QApplication(sys.argv)

w = QtWidgets.QWidget()
trayIcon = SystemTrayIcon(QtGui.QIcon("pic.ico"), w)
trayIcon.show()
Thread(target=some_random_function).start() # æˆ‘çš„è„šæœ¬å‡½æ•°
sys.exit(app.exec_())
```
  è¿™æ ·åšå®Œä¹‹åä¸œè¥¿ç¡®å®å¯ä»¥è¿è¡Œäº†ï¼Œä¸è¿‡æˆ‘çš„ä»£ç è¿˜è¦åœ¨å…¶ä»–äººçš„ç”µè„‘ä¸Šè¿è¡Œï¼Œæ‰€ä»¥æˆ‘å…ˆç”¨Pyinstalleræ‰“åŒ…äº†ä¸€ä¸‹ï¼Œä¸è¿‡æ‰“åŒ…å‡ºæ¥çš„ç¨‹åºå¾ˆå¤§ï¼Œå°±å‡ åè¡Œä»£ç å°±ç®—åŠ ä¸ŠPythonè§£æå™¨æœ€å¤šä¹Ÿå°±ä¸åˆ°10MiBï¼Œç»“æœè¿™åŠ ä¸ŠPyQtåº“ä¹‹åç›´æ¥ä¸Šå‡åˆ°40MiBå·¦å³ï¼Œå°±ç®—ç”¨upxå‹ç¼©å®Œä¹Ÿæœ‰30å¤šMiBï¼Œå®åœ¨æ˜¯è®©äººæ— æ³•å¿å—ï¼Œäºæ˜¯æˆ‘å°±è€ƒè™‘çœ‹çœ‹èƒ½ä¸èƒ½ç”¨å…¶ä»–æ–¹å¼æ¥åˆ¶ä½œè¿™ä¸ªå›¾æ ‡ã€‚   
  åæ¥æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°æœ‰ä¸€ä¸ªå«åšpystrayçš„åº“ä¼¼ä¹æ˜¯ä¸“é—¨å¹²è¿™ä¸ªæ´»çš„ã€‚é‚£æ—¢ç„¶æ˜¯ä¸“é—¨å¹²è¿™ä¸ªçš„é‚£å¤§å°è‚¯å®šæ¯”ä»€ä¹ˆQtåº“è¦å°å¾—å¤šå§ï¼Ÿäºæ˜¯æˆ‘æŒ‰ç…§ç¤ºä¾‹çš„ä»£ç éšä¾¿å†™äº†ä¸€æ®µï¼š
### ä½¿ç”¨pystrayåº“å®ç°
```python
from threading import Thread
import pystray
from PIL import Image

image = Image.open("pic.png")
icon = pystray.Icon(name="SomeRandom", icon=image, title="SomeRandom", menu=None)

Thread(target=some_random_function).start() # æˆ‘çš„è„šæœ¬å‡½æ•°
icon.run()
```
  è¿™ä¸ªä»£ç æˆ‘æ²¡æœ‰æµ‹è¯•è¿‡ï¼Œä¸è¿‡åœ¨æˆ‘å†™å®Œä¹‹åé¦–å…ˆç”¨Pyinstalleræ‰“åŒ…äº†ä¸€ä¸‹ï¼Œç»“æœå¤§å°æ¯”ç”¨PyQt5è¿˜è¦å¤§ğŸ˜‚ï¼Œæ‰“åŒ…å®Œå¤§å°è¦60å¤šMiBï¼Œæ‰€ä»¥æ²¡åŠæ³•æˆ‘å°±åªèƒ½ç»§ç»­ç”¨Qtçš„é‚£ä¸ªç‰ˆæœ¬äº†â€¦â€¦

## åˆ¶ä½œæ‚¬æµ®å›¾æ ‡
  åæ¥æˆ‘çš„è„šæœ¬ç”±äºåº”ç”¨é¢å¹¿æ³›éœ€è¦åœ¨Ubuntuä¸Šä½¿ç”¨ï¼Œæœ€æ–°çš„Ubuntuä½¿ç”¨çš„GNOMEæ¡Œé¢[ä¸å†æ”¯æŒæ‰˜ç›˜åŒº](https://blogs.gnome.org/aday/2017/08/31/status-icons-and-gnome/)äº†ğŸ˜“ï¼Œæ‰€ä»¥æ²¡åŠæ³•ï¼Œåªèƒ½æƒ³åˆ«çš„åŠæ³•äº†ã€‚   
  ç°åœ¨çš„ç¨‹åºé™¤äº†æ‰˜ç›˜åŒºå›¾æ ‡è¯æ˜è‡ªå·±çš„å­˜åœ¨å¯èƒ½è¿˜æœ‰å°±æ˜¯æ‚¬æµ®çƒäº†å§ï¼Ÿå›½äº§å¾ˆå¤šè½¯ä»¶å–œæ¬¢æŠŠè‡ªå·±ç¨‹åºæ•´æˆæ‚¬æµ®çƒé‚£æ ·æ”¾åœ¨æ¡Œé¢ä¸Šå¸å¼•ç”¨æˆ·çš„æ³¨æ„åŠ›ï¼Œæ‰€ä»¥æˆ‘çš„ç¨‹åºä¹Ÿè¦è¿™æ ·æã€‚æˆ‘æƒ³äº†æƒ³ç”¨PyQtåº“å®åœ¨æ˜¯å¤ªé‡äº†ï¼Œæˆ‘æƒ³æ•´ä¸ªè½»é‡çš„å›¾å½¢å¼•æ“ï¼ŒåƒPythonè‡ªå¸¦çš„Tkinterå°±æŒºä¸é”™çš„ï¼Œæ‰€ä»¥æˆ‘é¦–å…ˆç”¨Tkinteråšäº†ä¸€ä¸ªç‰ˆæœ¬å‡ºæ¥ï¼š
### é€šè¿‡Tkinterå®ç°
```python
import tkinter
from threading import Thread

root = tkinter.Tk()
height = 100
width = 100
root.overrideredirect(True)
root.attributes('-transparentcolor', "white")
root.attributes("-alpha", 0.9)  # çª—å£é€æ˜åº¦10 %
root.attributes("-topmost", 1)
root.geometry(f"{height}x{width}-40+60")
canvas = tkinter.Canvas(root, height=height, width=width, bg="white")
canvas.config(highlightthickness=0)
image_file = tkinter.PhotoImage(file=r'pic.png')
image = canvas.create_image(
    height//2, width//2, anchor=tkinter.CENTER, image=image_file)
canvas.pack()
x, y = 0, 0

show_menu = tkinter.Menu(root, tearoff=0)
show_menu.add_command(label="SomeRandom")

def move(event):
    global x, y
    new_x = (event.x-x)+root.winfo_x()-height//2
    new_y = (event.y-y)+root.winfo_y()-width//2
    s = f"{height}x{width}+" + str(new_x)+"+" + str(new_y)
    root.geometry(s)

canvas.bind("<B1-Motion>", move)
canvas.bind("<Enter>", lambda event: show_menu.post(event.x_root, event.y_root))
canvas.bind("<Leave>", lambda e: show_menu.unpost())

Thread(target=some_random_function).start() # æˆ‘çš„è„šæœ¬å‡½æ•°

root.mainloop()
```
  è¿™ä¸ªä»£ç åœ¨Windowsä¸Šå·¥ä½œè¿˜ç®—å¯ä»¥ï¼Œé—®é¢˜ä¸æ˜¯å¾ˆå¤šï¼Œä½†æ˜¯åœ¨Linuxä¸Šå°±å‡ºç°äº†å¾ˆç³Ÿç³•çš„é—®é¢˜ï¼Œæ ¹æ®tcl/tk [documentation](https://wiki.tcl-lang.org/page/wm+attributes) ~~å¥½åƒä¹Ÿæ²¡å†™ğŸ¤£~~ ï¼Œâ€œ-transparentcolorâ€å±æ€§åªèƒ½åœ¨Windowsç­‰ç³»ç»Ÿä½¿ç”¨ï¼ˆè²Œä¼¼MacOSä¹Ÿèƒ½ç”¨ï¼Ÿï¼‰ï¼Œå› æ­¤åœ¨Linuxä¸­ä¼šæŠ¥é”™ã€‚å¦‚æœä¸èƒ½ä½¿ç”¨é€æ˜èƒŒæ™¯æ•ˆæœå°±ä¼šå¾ˆå·®ï¼Œæˆ‘çœ‹Stack Overflowä¸Šæœ‰äººè¯´å¯ä»¥å®‰è£…ä¸€ä¸ªpqivå›¾ç‰‡æŸ¥çœ‹å™¨ï¼Œç„¶åä½¿ç”¨`os.popen()`æˆ–è€…`subprocess.Popen()`æ‰§è¡Œ`pqiv -c -c -i pic.png`ä¹Ÿèƒ½è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœï¼Œä¸è¿‡è¿™ç§ä¸œè¥¿å…ˆä¸è¯´è¿˜è¦å®‰è£…ï¼Œè€Œä¸”è¿™ä¸ªä¸œè¥¿ç‚¹ä¸¤ä¸‹å°±èƒ½çœ‹è§å®ƒçš„çª—å£ï¼Œè¿˜èƒ½å…³é—­ï¼Œé‚£è‚¯å®šæ˜¯ä¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚çš„ã€‚æ‰€ä»¥æ²¡åŠæ³•â€¦â€¦åªèƒ½å†è€ƒè™‘Qtçš„åŠæ³•äº†ã€‚   
### ä½¿ç”¨PyQt5åº“å®ç°
  æˆ‘åœ¨ç½‘ä¸Šåˆæ‰¾äº†äº›èµ„æ–™æŠŠPyQtçš„ç‰ˆæœ¬ä¹Ÿåšå‡ºæ¥äº†ï¼Œè€Œä¸”è¿˜åŠ äº†æ”¯æŒGifåŠ¨æ€å›¾ç‰‡çš„æ•ˆæœï¼š
```python
import sys
from PyQt5.QtWidgets import *
from PyQt5.QtGui import *
from PyQt5.QtCore import *

class Example(QWidget):
    def __init__(self):
        super().__init__()
        self.initUI()
    
    def mouseMoveEvent(self, e: QMouseEvent):  # é‡å†™ç§»åŠ¨äº‹ä»¶
        if self._tracking:
            self._endPos = e.pos() - self._startPos
            self.move(self.pos() + self._endPos)
 
    def mousePressEvent(self, e: QMouseEvent):
        if e.button() == Qt.LeftButton:
            self._startPos = QPoint(e.x(), e.y())
            self._tracking = True
 
    def mouseReleaseEvent(self, e: QMouseEvent):
        if e.button() == Qt.LeftButton:
            self._tracking = False
            self._startPos = None
            self._endPos = None

    def initUI(self):
        layout = QStackedLayout()
        self.lbl1 = QLabel(self)
        self.movie = QMovie("pic.gif")
        self.lbl1.setMovie(self.movie)
        self.movie.start()
        self.lbl1.setToolTip("SomeRandom")
        layout.addWidget(self.lbl1)

        self.setAttribute(Qt.WA_TranslucentBackground)
        self.setWindowFlags(Qt.WindowStaysOnTopHint | Qt.FramelessWindowHint | Qt.Tool)

        #layout area for widgets
        layout.setCurrentIndex(1)
        self.setLayout(layout)
        self.setGeometry(QApplication.desktop().width()-130,50,100,100)
        self.show()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    Thread(target=some_random_function).start() # æˆ‘çš„è„šæœ¬å‡½æ•°
    ex = Example()
    sys.exit(app.exec_())
```
  æœ€ç»ˆåšå‡ºæ¥æ•ˆæœè¿˜ä¸é”™ï¼Œè¯´ä¸å®šåŠ ç‚¹åŠŸèƒ½æ”¾ç»„ç®€å•çš„ç«‹ç»˜åŠ¨ç”»å°±èƒ½åšä¸€ä¸ªåƒæˆ‘åšå®¢å·¦ä¸‹è§’çš„çœ‹æ¿å¨˜ä¸€æ ·çš„ä¸œè¥¿å‘¢ğŸ¤£ï¼Œè™½ç„¶æˆ‘ä¹Ÿè§è¿‡ç”¨Electronå†™çš„[PPet](https://github.com/zenghongtu/PPet)ï¼Œä¸è¿‡ç”¨Pythonå†™çš„è¯å¯èƒ½å¯¹æ›´å¤šäººæ›´å‹å¥½å§ ~~ï¼ˆGifå“ªèƒ½å’ŒLive2Dæ¯”ğŸ˜‚ï¼‰~~ ã€‚   

# æ„Ÿæƒ³
  è¿™æ¬¡åšè¿™ä¹ˆä¸€ä¸ªPythonç¨‹åºè¿è¡Œçš„æç¤ºæ ‡å¿—è¿˜çœŸæ˜¯å¤æ‚å•Šï¼Œå°¤å…¶æ˜¯ä¸ºäº†è·¨å¹³å°ï¼Œå…¶å®ä¸“é—¨å¯¹åº”ä¸€ä¸ªå¹³å°åšèµ·æ¥å¯èƒ½ä¹Ÿæ²¡æœ‰å¾ˆå¤æ‚ï¼Œä¸è¿‡æƒ³èƒ½åœ¨å„ä¸ªå¹³å°ä¸Šéƒ½èƒ½ä½¿ç”¨è¿˜æ˜¯æŒºéš¾çš„ã€‚è¿™æ¬¡æ¥çœ‹Qtçš„è·¨å¹³å°æ€§ç¡®å®å¾ˆå¼ºï¼Œæ— è®ºæ˜¯åœ¨å“ªä¸ªå¹³å°ä¸Šéƒ½èƒ½è·å¾—ä¸é”™çš„ä½“éªŒï¼Œå°±æ˜¯ç”¨èµ·æ¥æ„Ÿè§‰æ¯”è¾ƒéº»çƒ¦ï¼Œå…¶å®è¯´æ¥å¦‚æœèƒ½ç”¨C++ä¹‹ç±»çš„è¯­è¨€å»å¼€å‘Qtç¨‹åºåº”è¯¥æ›´å¥½ï¼ŒPythonè¿™ä¸ªåŸºæœ¬ä¸Šä¹Ÿå°±åªèƒ½å½“ä½œä¸€ä¸ªç©å…·ç®—æ˜¯ç†Ÿæ‚‰ä¸€ä¸‹Qtçš„å„ç§åŠŸèƒ½äº†ã€‚   
